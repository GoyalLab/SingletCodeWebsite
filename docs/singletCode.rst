===================
Singlet Code
===================

singletCode is a framework  to extract true singlets from datasets utilizing several barcoding technologies(read more about the barcode technologies we used singletCode with here). 


Singlet identification
-----------------------------------
Singlet Code leverages the fact that the lineage barcodes are within the cell before oil encapsulation for sequencing. Therefore, a cell would have one lineage barcode or a result of multiplicity, more than one barcode but with restrictions.

A cell which meets any of these conditions is inferred to be a true singlet:
   #. A single barcode is identified per cell ID, including cases where there are multiple barcodes but one barcode has significantly higher UMI count associated with it
   #. multiple barcodes is present in the cell, but the same barcode combination is found in other cells in the same sample 
   #. multiple barcodes is present in the cell cell, but the same barcode combination is found in other cells across samples within the same experimental design (common for barcoding studies)

.. figure:: /images/singletCode-1.png
   :scale: 50 %
   :alt: Schematic to show how doublets are identified by singletCode
   
   Schematic to show how doublets are identified by singletCode

.. _simulationInfo:

Simulation Datasets 
---------------------------------------
To simulate the doublets, we randomly selected the gene expression counts data from two cells we identify as true singlets. We averaged or summed the counts from these two cells to generate simulated doublets.  

For a desired doublet percentage, we generated an initial number of doublets based on the initial assumption that doublets are generated from singlets without replacement such that, for each doublet generated, the total number of cells will decrease by 1. Then, it follows that:  `number of doublets = (doublet percentage)*(number of initial singlets - number of doublets)`.

We generated the number of doublets determined by this formula. Next, we removed the singlet cells used to create doublets and corrected for generating doublets from singlets with replacement to ensure the desired doublet percentage.
  
The final number of singlets is given by  `number of singlets = number of doublets*((1 - doublet percentage)/(doublet percentage))` and we subsampled that number of singlets to be included in the final matrix. This approach minimized the number of cells that needed to be trimmed in the doublet generation process to maintain desired doublet percentages. 
In the rare cases where there were not enough singlets remaining after those used to create doublets were removed, the number of doublets was instead calculated according to  `number of doublets = doublet percentage * (number of singlets/(1 - doublet percentage))`.

.. figure:: /images/singletCode-2.png
   :scale: 50 %
   :alt: Method to simulate doublets using true singlets from singletCode
   
   Method to simulate doublets using true singlets from singletCode

The final scRNA-seq datasets are generated by adding such simulated doublets into the datasets at different percentages (10-40%).
 
.. contents:: Contents:
   :local: